# M7016E_Project
The service is built as a part of [M1990] course . The project architecture .

Openhab is used as a middleware. 
  * Z-wave binding to collect data 
  * Rules engine to define event triggered rules 
  * Persistence to save data to MongoDB database 
  * Sitemap to git a user interface  
  * Item repository to git stateful items

This project is built as a separate service to get out of Openhab environment restrictions. The service goal is to analyze and actuate according to data generated by the environment in a long term, making it possible to observe behaviors.

The service is built with loosely coupled component in mind, making it easier to add new features .

##Features

#### Pull/Push values to/from Openhab
Using Openhab REST API we can push or pull a value to Openhab. The feature allow us to control the home environment, turn on/off objects , get the current object's value . Togother with the database data the service get a greate deal of flexibility. 
* **pull a value** 

```java
OpenhabClient openHab = new OpenhabClient(OPENHAB_IP, OPENHAB_PORT);
			try {
				openHab.pullItemValue(METER_SWITCH);
			} catch (IOException e) {
				e.printStackTrace();
			}
```

* **push a value** 
```java
OpenhabClient openHab = new OpenhabClient(OPENHAB_IP, OPENHAB_PORT);
			try {
				openHab.pushItemValue(METER_SWITCH , OFF);
			} catch (IOException e) {
				e.printStackTrace();
			}
```
#### Get weather status
We use OpenWeatherMap API to get the weather status.  
**Example:**
```java
OpenWeatherMap weather = new OpenWeatherMap();
		try {
			weather.getWeather();
		} catch (IOException e) {
			e.printStackTrace();
		}
```
#### Send notifications
Pushbullet is an app syncs phone and browser notification , Using its API we send notifications to the user.  
**Example:**
```java
PushbulletClient sendBullet = new PushbulletClient();
    try {
			sendBullet.sendNote(String noteTitle , String noteCotent);
		} catch (IOException e) {
			e.printStackTrace();
		}
```
#### Calculate activities time
To support the service aim ( i.e. analysis long term data ) the service has findActivityTime function which calculate how long a sensor's value was ON “true” within a given date.  
**Example:**
```java
MongoDB db = new MongoDBMongoDB(String hostAddress,int hostPort , String database , String collection);
database.connect();
ActivitiesTime getTime = new ActivitiesTime();
long sleep = getTime.findActivityTime(startTime, endTime, MATTRESS_SENSOR);
```
#### Log activity  
give the user a weekly log of his activities at home , currently  monitored activities are (sleep , presence at home , moving at home ,watching  TV , cooking).  
**Example:**
```java
MongoDB db = new MongoDBMongoDB(String hostAddress,int hostPort , String database , String collection);
database.connect();
LogActivity log = new LogActivity(startTime , endTime);
log.getLog();
try {
			log.sendLog();
		} catch (IOException e) {
			e.printStackTrace();
		}
```
#### Suggest an activity   
if the weather is good and the user is at home it will suggest to him to go out.  
**Example:**
```java
SuggestActivity activity = new SuggestActivity();
		try {
			activity.suggestWeather();
		} catch (IOException e) {
			e.printStackTrace();
		}
```
